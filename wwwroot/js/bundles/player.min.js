async function isAuthorized(){return await fetch("/api/authorize",{method:"GET",headers:{Authorization:localStorage.getItem("Authorization")}}).then(n=>n.ok)}async function getGameStateAsync(){return await fetch("/api/gameState").then(n=>n.json()).then(n=>n)}async function getPlayer(){return await fetch("api/players/"+localStorage.getItem("playerId")).then(n=>n.json()).then(n=>n)}async function getPlayersAsync(){return await fetch("/api/players").then(n=>n.json()).then(n=>n)}async function getImageEntityAsync(n){return fetch("/api/images/entity/"+n).then(n=>n.json()).then(n=>n).catch(()=>null)}function mobileCheck(){let n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}async function loadImageAsync(n,t){return new Promise((i,r)=>{n.onload=()=>i(n),n.onerror=r,n.src=t})}function loadThemeCss(n){n.themeCss&&(document.getElementById("themeCssLink").href.indexOf(n.themeCss)>0||(document.getElementById("themeCssLink").href="themes/"+n.themeCss+".css"))}async function getBlobContainers(){return await fetch("/api/images/blobContainers",{method:"GET",headers:{Authorization:localStorage.getItem("Authorization")}}).then(n=>n.json()).then(n=>n)}function drawBlobContainers(n,t){var i=document.getElementById(t);n.forEach(function(n){var t=document.createElement("option");t.value=n.name;t.appendChild(document.createTextNode(n.name));i.appendChild(t)})}function drawGameState(n){Object.keys(n).forEach(function(t){var i=document.getElementById(t);i&&(i.nodeName==="DIV"||i.nodeName==="SPAN"?document.getElementById(t).innerHTML=n[t]:document.getElementById(t).value=n[t])})}function drawPanelButtons(){for(var u,n,t,i,f,r=1,o=document.getElementById("panelButtons"),e=0;e<down;e++)for(u=0;u<across;u++)n=document.createElement("div"),n.classList.add("panelButton"),n.classList.add("noHighlights"),n.classList.add("panelButtonDisabled"),n.onclick=panelButtonOnClick,n.value=r+"",t=document.createElement("div"),t.classList.add("panelButtonBackground"),n.appendChild(t),i=document.createElement("div"),i.classList.add("panelButtonNumber"),i.appendChild(document.createTextNode(r)),t.appendChild(i),f=document.createElement("img"),f.classList.add("panelButtonImage"),n.appendChild(f),o.appendChild(n),r++}function updatePanelButtons(n,t){var u=document.getElementsByClassName("panelButton"),i,r;t||(t=[]);for(i of u)r=i.lastChild,n.revealedPanels.includes(i.value)?(i.classList.add("panelButtonDisabled"),i.classList.remove("panelButtonSelected"),r.src="/api/images/panels/"+n.imageId+"/"+i.value):t.includes(i.value)?(i.classList.add("panelButtonDisabled"),i.classList.remove("panelButtonSelected"),r.src="/api/images/panels/"+n.imageId+"/0"):(i.classList.remove("panelButtonDisabled"),r.src="/api/images/panels/"+n.imageId+"/0")}function shuffle(n){for(var t=n.length,r,i;0!==t;)i=Math.floor(Math.random()*t),t-=1,r=n[t],n[t]=n[i],n[i]=r;return n}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}function clearPanelButtonSelection(){var n=document.getElementsByClassName("panelButton");for(var t of n)t.classList.remove("panelButtonSelected")}async function sendSelectedPanels(){var n,i,t;if(localStorage.getItem("playerName")){n=[];i=document.getElementsByClassName("panelButtonSelected");for(t of i)t.classList.contains("panelButtonDisabled")||n.push(t.value);await connection.invoke("SelectPanels",{PlayerId:localStorage.getItem("playerId"),Name:localStorage.getItem("playerName"),TeamNumber:parseInt(localStorage.getItem("teamNumber")),SelectedPanels:n})}}function pixelRatio(){let n=window.screen.width,t=window.screen.height,i=window.devicePixelRatio;document.getElementById("width").innerHTML=n;document.getElementById("height").innerHTML=t;document.getElementById("ratio").innerHTML=i;console.log("Width: "+n);console.log("Height: "+t);console.log("Pixel  Ratio: "+i)}function getRenderedSize(n,t,i,r,u,f){var e=r/u,o=t/i;return function(){return(n?e>o:e<o)?(this.width=t,this.height=t/e):(this.width=i*e,this.height=i),this.left=(t-this.width)*(f/100),this.right=this.width+this.left,this}.call({})}function getImgSizeInfo(n){var t=window.getComputedStyle(n).getPropertyValue("object-position").split(" ");return getRenderedSize(!0,n.width,n.height,n.naturalWidth,n.naturalHeight,parseInt(t[0]))}function setupInputDefaultText(n,t,i){var r=document.getElementById(n);r.defaultValue=t;i?r.value=i:(r.classList.add("inputDefaultText"),r.value=r.defaultValue);r.onfocus=n=>{n.target.value===n.target.defaultValue&&(n.target.value="",n.target.classList.remove("inputDefaultText"))};r.onblur=n=>{n.target.value||(n.target.value=n.target.defaultValue,n.target.classList.add("inputDefaultText"))};r.onchange=n=>{n&&n.target.value&&n.target.value!==n.target.defaultValue||(n.target.value=n.target.defaultValue,n.target.classList.add("inputDefaultText"))}}function setupAdminMenu(){var n=document.getElementById("adminMenu"),u=document.createElement("a"),t,i,r;u.appendChild(document.createTextNode("Admin"));u.href="admin";n.appendChild(u);t=document.createElement("a");t.appendChild(document.createTextNode("Upload"));t.href="upload";n.appendChild(t);i=document.createElement("a");i.appendChild(document.createTextNode("List"));i.href="listimages";n.appendChild(i);r=document.createElement("a");r.appendChild(document.createTextNode("Setup"));r.href="setup";n.appendChild(r)}function createSignalRConnection(n){connection=(new signalR.HubConnectionBuilder).withUrl("/signalRHub?user="+localStorage.getItem("playerId")+"_"+n).withAutomaticReconnect().configureLogging(signalR.LogLevel.Information).build();registerConnections()}function signalRMonitor(){if(!connection){reconnectingCount=0;document.getElementById("signalRConnectionState").classList.add("hidden");return}if(connection.state==="Connected"){document.getElementById("signalRConnectionState").classList.add("hidden");return}if(document.getElementById("signalRConnectionState").classList.remove("hidden"),connection.state==="Disconnecting"||connection.state==="Disconnected"){document.getElementById("signalRConnectionState").innerHTML="Disconnected from server. <a href='javascript: window.location.reload(true);'>Reload Page<\/a>";return}if(connection.state==="Connecting"||connection.state==="Reconnecting"){reconnectingCount++;document.getElementById("signalRConnectionState").innerHTML=reconnectingCount>4?"Reconnecting to server...<a href='javascript: window.location.reload(true);'>Reload Page<\/a>":"Reconnecting to server...";return}}function reloadPage(){location.reload()}function animateCSS(n,t,i,r=0,u=false,f="animate__"){function o(n){n.stopPropagation();e.classList.remove(...t)}var e;return e=typeof n!="string"?n:document.querySelector(n),e.classList.add(f+"animated"),new Promise(n=>{setTimeout(()=>{t=t.map(n=>f+n),i=i.map(n=>f+n),e.classList.add(...t),e.classList.remove(...i),u&&e.addEventListener("animationend",o,{once:!0}),n()},r)})}async function startSignalRAsync(n){if(!document.getElementById("signalRConnectionState")){var t=document.createElement("div");t.classList="hidden";t.id="signalRConnectionState";document.body.appendChild(t)}if(connection&&connection.state==="Connected"){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR already connected.");return}signalRTimeOut||(createSignalRConnection(n),await connection.start(),setTimeout(function(){signalRTimeOut=!0;playerIsReadyToPlay=!1;drawSystemChat("chats","You have been disconnected from the server. Refresh the page to connect again.");connection.stop()},144e5),setInterval(signalRMonitor,1e3),localStorage.getItem("debug")&&drawSystemChat("chats","SignalR started: "+n))}async function getChats(n){return n||(n=localStorage.getItem("teamNumber")),await fetch("api/chats/"+n).then(n=>n.json()).then(n=>n)}async function drawChatsAsync(n,t){for(var i=document.getElementById(n),r;i.firstChild;)i.removeChild(i.firstChild);setupChatTypingIndicator(n);r=await getChats(t);r.forEach(t=>{drawChat(n,t.message,t.player,!0)})}function setupChats(n,t){var i,r;if(t||(t=parseInt(localStorage.getItem("teamNumber"))),!t)throw new Error("No team number set in setupChats");i=document.getElementById(n);i.classList.add("smoothScroll");i.onclick=function(){document.getElementById(n+"_inputText").blur()};document.getElementById(n+"_send").onclick=function(){sendChat(n,t)};r=document.getElementById(n+"_inputText");r.onkeyup=i=>{if(i.which===13){sendChat(n,t);return}lastTypingTime&&new Date-lastTypingTime<typingIndicatorTime-1e3||(lastTypingTime=new Date,connection.invoke("Typing",{PlayerId:localStorage.getItem("playerId"),Name:localStorage.getItem("playerName"),TeamNumber:t}))};setupInputDefaultText(n+"_inputText","send a team message...");setupChatTypingIndicator(n)}function setupChatTypingIndicator(n){var t,u,f,r,i,e;if(!document.getElementById(n+"_typingIndicator")){for(t=document.createElement("div"),t.id=n+"_typingIndicator",t.classList.add("chat"),t.classList.add("othersChat"),t.classList.add("hidden"),u=document.createElement("span"),u.id=n+"_typingIndicatorPlayers",t.appendChild(u),f=document.createElement("span"),f.appendChild(document.createTextNode(": ")),t.appendChild(f),r=1;r<=3;r++)i=document.createElement("span"),i.classList.add("ellipsis"),i.classList.add("ellipsis"+r),i.appendChild(document.createTextNode(".")),t.appendChild(i);e=document.getElementById(n);e.prepend(t)}}function drawChat(n,t,i,r){var o=document.getElementById(n),u,e,f,s;t=t.replaceAll(imageRegex,'<img class="chatImage" src="$1"/>');u=document.createElement("div");u.classList.add("chat");i?i.playerId===localStorage.getItem("playerId")?(stoppedTyping(n,i),u.classList.add("selfChat"),f=document.createElement("span"),f.innerHTML=t,u.appendChild(f)):(stoppedTyping(n,i),u.classList.add("othersChat"),e=document.createElement("span"),i.isAdmin&&e.classList.add("adminPlayerName"),e.style="color: "+i.color+";",e.appendChild(document.createTextNode(i.name)),u.appendChild(e),f=document.createElement("span"),f.innerHTML=": "+t,u.appendChild(f)):(u.classList.add("othersChat"),f=document.createElement("span"),f.innerHTML="(unknown player): "+t,u.appendChild(f));s=document.getElementById(n+"_typingIndicator");s&&s.nextElementSibling?o.insertBefore(u,s.nextElementSibling):o.appendChild(u);o.childElementCount>1e3&&o.lastChild.remove();r||(i.playerId===localStorage.getItem("playerId")?scrollChats(n,!0):scrollChats(n))}function drawSystemChat(n,t,i){var r=document.createElement("div"),u,o,f,e;r.classList.add("chat");r.classList.add("systemChat");i&&(u=document.createElement("span"),i.isAdmin&&u.classList.add("adminPlayerName"),u.style="color: "+i.color+";",u.appendChild(document.createTextNode(i.name+" ")),r.appendChild(u));o=document.createElement("span");o.appendChild(document.createTextNode(t));r.appendChild(o);f=document.getElementById(n);e=document.getElementById(n+"_typingIndicator");e&&e.nextElementSibling?f.insertBefore(r,e.nextElementSibling):f.appendChild(r);f.childElementCount>1e3&&f.lastChild.remove();scrollChats(n)}function scrollChats(n,t){var i=document.getElementById(n);(t||i.scrollTop>-150)&&(i.scrollTop=i.scrollHeight)}function handleTyping(n,t){t.playerId!==localStorage.getItem("playerId")&&(playersTyping[n]||(playersTyping[n]={}),playersTyping[n][t.playerId]=t,playersTyping[n][t.playerId].typingTime=new Date,drawTypingIndicators(n),scrollChats(n))}function stoppedTyping(n,t){playersTyping[n]&&(delete playersTyping[n][t.playerId],drawTypingIndicators(n))}function drawTypingIndicators(n){var o,i,r,e,s,u,f,t;clearInterval(typingIndicatorsTimeouts[n]);o=document.getElementById(n+"_typingIndicator");i=document.getElementById(n+"_typingIndicatorPlayers");i.innerHTML="";r=3;e=r;for(s in playersTyping[n]){if(u=playersTyping[n][s],new Date-u.typingTime>typingIndicatorTime){delete playersTyping[n][s];continue}if(e<r&&(t=document.createElement("span"),t.appendChild(document.createTextNode(", ")),i.appendChild(t)),f=document.createElement("span"),u.isAdmin&&f.classList.add("adminPlayerName"),f.style="color: "+u.color+";",f.appendChild(document.createTextNode(u.name)),i.appendChild(f),e--,e<=0)break}Object.keys(playersTyping[n]).length>r&&(t=document.createElement("span"),t.appendChild(document.createTextNode(", +"+(Object.keys(playersTyping[n]).length-r))),i.appendChild(t));Object.keys(playersTyping[n]).length>0?(o.classList.remove("hidden"),typingIndicatorsTimeouts[n]=setTimeout(function(){drawTypingIndicators(n)},1e3)):o.classList.add("hidden")}async function sendChat(n,t){var i=document.getElementById(n+"_inputText"),r;i.value&&i.value!==i.defaultValue&&(mobileCheck()&&i.focus(),lastTypingTime=null,r={playerId:localStorage.getItem("playerId"),name:localStorage.getItem("playerName"),teamNumber:t},connection.invoke("Chat",r,i.value),drawChat(n,i.value,r),document.activeElement===i?i.value="":(i.value=i.defaultValue,i.classList.add("inputDefaultText")))}async function panelButtonOnClick(n){if(n.currentTarget.classList.contains("panelButtonDisabled")){n.currentTarget.classList.remove("panelButtonSelected");return}n.currentTarget.classList.toggle("panelButtonSelected");n.currentTarget.blur();await sendSelectedPanels()}function setupPlayerMenu(){var n="hsl("+Math.ceil(Math.random()*360)+", 100%, 50%)";localStorage.getItem("playerColor")&&(n=localStorage.getItem("playerColor"));window.colorPicker=new iro.ColorPicker("#colorPicker",{layout:[{component:iro.ui.Wheel,options:{}},],color:n,width:Math.ceil(Math.min(300,window.screen.width*.65))});localStorage.getItem("playerName")&&(document.getElementById("playerNameInput").style.color=n);document.getElementById("playerNameInput").oninput=function(n){n.target.style.color=window.colorPicker.color.hslString};window.colorPicker.on("color:change",function(n){n.value=100;document.getElementById("playerNameInput").style.color=n.hslString});setupInputDefaultText("playerNameInput","your name",localStorage.getItem("playerName"))}function drawPlayer(n){var i,t;if(n.selectedPanels){i=document.getElementsByClassName("panelButton");for(t of i)n.selectedPanels.includes(t.value)&&t.classList.add("panelButtonSelected")}n.isAdmin&&document.getElementById("playerName").classList.add("adminPlayerName")}async function putPlayerAsync(){return await fetch("api/players/"+localStorage.getItem("playerId"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({PlayerId:localStorage.getItem("playerId"),Name:localStorage.getItem("playerName"),TeamNumber:parseInt(localStorage.getItem("teamNumber")),Color:localStorage.getItem("playerColor")})}).then(n=>n.json()).then(n=>n)}async function putPlayerPingAsync(){playerIsReadyToPlay&&await fetch("api/players/"+localStorage.getItem("playerId")+"/ping",{method:"PUT",headers:{"Content-Type":"application/json"}})}async function postTeamGuessAsync(){playerIsReadyToPlay&&await fetch("api/teamGuess/"+localStorage.getItem("teamNumber"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Guess:document.getElementById("chats_inputText").value})}).then(()=>{document.getElementById("chats_inputText").value=""})}async function getTeamGuessesAsync(){return await fetch("/api/teamGuess/"+localStorage.getItem("teamNumber")).then(n=>n.json()).then(n=>n)}async function deleteTeamGuessAsync(n){playerIsReadyToPlay&&await fetch("api/teamGuess/"+localStorage.getItem("teamNumber")+"/"+n,{method:"DELETE"})}function setupChoosePlayerName(){playerIsReadyToPlay=!1;document.getElementById("chooseSmallestTeam").innerHTML="Choose for me";document.getElementById("turnStatusMessage").classList.add("hidden");document.getElementById("choosePlayerNameLabel").classList.remove("hidden");document.getElementById("playerNameInputDiv").classList.remove("hidden");document.getElementById("colorPicker").classList.remove("hidden");document.getElementById("choosePlayerName").classList.remove("hidden");document.getElementById("playerBanner").classList.add("hidden");document.getElementById("chooseTeam").classList.add("hidden");document.getElementById("teamOneName").classList.add("hidden");document.getElementById("teamTwoName").classList.add("hidden");document.getElementById("playerName").classList.add("hidden");document.getElementById("teamOneName").classList.add("chooseTeamName");document.getElementById("teamTwoName").classList.add("chooseTeamName");document.getElementById("chooseSmallestTeam").classList.remove("hidden");document.getElementById("panelButtons").classList.add("hidden");document.getElementById("chats").classList.add("hidden");document.getElementById("chats_input").classList.add("hidden");document.getElementById("playerName").style.color=localStorage.getItem("playerColor");document.getElementById("playerBanner").classList.add("playerBannerChooseTeam");document.getElementById("playerBanner").classList.remove("playerBannerPlaying");document.getElementById("playerBanner").onclick=null;document.getElementById("turnStatusMessage").onclick=null;document.getElementById("teamOneName").classList.remove("teamOneColor");document.getElementById("teamOneName").classList.add("teamOneBox");document.getElementById("teamTwoName").classList.remove("teamTwoColor");document.getElementById("teamTwoName").classList.add("teamTwoBox")}function choosePlayerNameButtonOnClick(){var n=document.getElementById("playerNameInput");if(n.value.length<=1||n.value===n.defaultValue){document.getElementById("playerNameInput").classList.add("playerNameInputDivInvalid");return}playerNameChosen({name:document.getElementById("playerNameInput").value,color:window.colorPicker.color.hslString})}function playerNameChosen(n){localStorage.setItem("playerName",n.name);localStorage.setItem("playerColor",n.color);document.getElementById("playerName").innerHTML=n.name;document.getElementById("choosePlayerNameLabel").classList.add("hidden");document.getElementById("playerNameInputDiv").classList.add("hidden");document.getElementById("colorPicker").classList.add("hidden");document.getElementById("choosePlayerName").classList.add("hidden");document.getElementById("playerBanner").classList.remove("hidden");document.getElementById("chooseTeam").classList.remove("hidden");document.getElementById("teamOneName").classList.remove("hidden");document.getElementById("teamTwoName").classList.remove("hidden");setupTeamSelectionButtons()}function teamChosen(n){localStorage.setItem("teamNumber",n);drawTeam(n);setupChats("chats")}function shouldPlayerLoadFromCache(){if(localStorage.getItem("createdTime")){var t=new Date(localStorage.getItem("createdTime")),n=new Date;if(n.setDate(n.getDate()-1),t>n)return!0}return!1}async function setupPlayerAsync(){if(shouldPlayerLoadFromCache()&&localStorage.getItem("playerName")&&localStorage.getItem("playerColor")&&localStorage.getItem("teamNumber"))return playerNameChosen({name:localStorage.getItem("playerName"),color:localStorage.getItem("playerColor")}),teamChosen(parseInt(localStorage.getItem("teamNumber"))),finalizePlayerAsync();localStorage.setItem("createdTime",new Date);setupChoosePlayerName()}async function finalizePlayerAsync(){var n,t;playerIsReadyToPlay=!0;handleGameState(await getGameStateAsync());n=[];n.push(putPlayerAsync());n.push(getTeamGuessesAsync());n.push(startSignalRAsync("player"));n.push(drawChatsAsync("chats"));t=await Promise.all(n);drawPlayer(t[0]);drawTeamGuesses(t[1]);document.getElementById("playerBanner").onclick=()=>{var n=confirm("Do you want to change your player name, color, or team?");n&&setupChoosePlayerName()};document.getElementById("turnStatusMessage").onclick=()=>{var n=confirm("Do you want to change your player name, color, or team?");n&&setupChoosePlayerName()};scrollChats("chats",!0)}function setupTeamSelectionButtons(){document.getElementById("teamOneName").onclick=async function(){teamChosen(1);await finalizePlayerAsync()};document.getElementById("teamTwoName").onclick=async function(){teamChosen(2);await finalizePlayerAsync()};document.getElementById("chooseSmallestTeam").onclick=async function(){await chooseSmallestTeam();await finalizePlayerAsync()}}async function chooseSmallestTeam(){document.getElementById("chooseSmallestTeam").innerHTML="Loading...";await fetch("api/players").then(n=>n.json()).then(n=>{for(var i=0,r=0,t=0;t<n.length;t++)n[t].playerId!==localStorage.getItem("playerId")&&(n[t].teamNumber===1?i++:r++);i<r?teamChosen(1):i>r?teamChosen(2):Math.random()<.5?teamChosen(1):teamChosen(2)})}function drawTeam(n){updatePlayerPanelButtons(currentGameState);document.getElementById("turnStatusMessage").classList.remove("hidden");n===1?(document.getElementById("teamOneName").classList.remove("hidden"),document.getElementById("teamTwoName").classList.add("hidden")):(document.getElementById("teamOneName").classList.add("hidden"),document.getElementById("teamTwoName").classList.remove("hidden"));document.getElementById("playerName").classList.remove("hidden");document.getElementById("teamOneName").classList.remove("chooseTeamName");document.getElementById("teamOneName").onclick=null;document.getElementById("teamTwoName").classList.remove("chooseTeamName");document.getElementById("teamTwoName").onclick=null;document.getElementById("chooseSmallestTeam").onclick=null;document.getElementById("chooseSmallestTeam").classList.add("hidden");document.getElementById("chooseTeam").classList.add("hidden");document.getElementById("chats").classList.remove("hidden");document.getElementById("chats_input").classList.remove("hidden");document.getElementById("playerName").style.color=localStorage.getItem("playerColor");document.getElementById("playerBanner").classList.remove("playerBannerChooseTeam");document.getElementById("playerBanner").classList.add("playerBannerPlaying");document.getElementById("teamOneName").classList.add("teamOneColor");document.getElementById("teamOneName").classList.remove("teamOneBox");document.getElementById("teamTwoName").classList.add("teamTwoColor");document.getElementById("teamTwoName").classList.remove("teamTwoBox")}function drawTurnType(n){if(n){if(document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageCorrect"),document.getElementById("teamGuessesInputContainer").classList.add("hidden"),document.getElementById("teamGuesses").classList.add("hidden"),n.turnType==="Welcome"){document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageVisible");document.getElementById("panelButtons").classList.add("hidden");document.getElementById("panelButtons").classList.remove("panelButtonsHighlight");return}if(n.turnType==="EndRound"){document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageVisible");document.getElementById("panelButtons").classList.add("hidden");document.getElementById("panelButtons").classList.remove("panelButtonsHighlight");document.getElementById("turnStatusMessage").innerHTML="This round is over.";return}switch(n.turnType){case"OpenPanel":n.teamTurn===parseInt(localStorage.getItem("teamNumber"))?(document.getElementById("turnStatusMessage").classList.add("turnStatusMessageVisible"),highlightturnStatusMessage(),document.getElementById("panelButtons").classList.remove("hidden"),document.getElementById("panelButtons").classList.remove("panelButtonsHighlight"),document.getElementById("turnStatusMessage").innerHTML="Vote for a panel to open"):(document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageVisible"),document.getElementById("panelButtons").classList.add("hidden"),document.getElementById("panelButtons").classList.remove("panelButtonsHighlight"));break;case"MakeGuess":document.getElementById("teamGuessesInputContainer").classList.remove("hidden");document.getElementById("teamGuesses").classList.remove("hidden");document.getElementById("panelButtons").classList.add("hidden");document.getElementById("panelButtons").classList.remove("panelButtonsHighlight");document.getElementById("turnStatusMessage").classList.add("turnStatusMessageVisible");document.getElementById("turnStatusMessage").innerHTML="Make your guess or pass";highlightturnStatusMessage();break;case"GuessesMade":document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageVisible")}}}function highlightturnStatusMessage(){document.getElementById("turnStatusMessage").classList.remove("turnStatusMessageHighlight");setTimeout(function(){document.getElementById("turnStatusMessage").classList.add("turnStatusMessageHighlight")},0)}function handleGameState(n){if((loadThemeCss(n),playerIsReadyToPlay&&(!currentGameState||currentGameState.turnType!==n.turnType||currentGameState.teamTurn!==n.teamTurn)?clearPanelButtonSelection():currentGameState&&currentGameState.imageId!==n.imageId&&clearPanelButtonSelection(),currentGameState=n,drawGameState(n),playerIsReadyToPlay)&&(drawTurnType(n),updatePlayerPanelButtons(n),n.turnType==="Welcome")){drawSystemChat("chats","Welcome to the Picture Panels game!");return}}function drawTeamGuesses(n){var t=document.getElementById("teamGuesses");t.innerHTML="";n.forEach(drawTeamGuess)}function deleteTeamGuess(n){document.getElementById("teamGuess_"+n).remove()}function drawTeamGuess(n){var r=document.getElementById("teamGuesses"),t=document.createElement("div"),i;t.id="teamGuess_"+n.ticks;t.classList="teamGuessText";localStorage.getItem("teamNumber")==="1"?t.classList.add("teamOneDarkColorBackground"):t.classList.add("teamTwoDarkColorBackground");t.appendChild(document.createTextNode(n.guess));i=document.createElement("div");teamGuessDeleteImageElement=document.createElement("img");teamGuessDeleteImageElement.src="img/x-mark.png";i.appendChild(teamGuessDeleteImageElement);i.onclick=()=>{var t=confirm("Delete the guess '"+n.guess+"'?");t&&deleteTeamGuessAsync(n.ticks)};i.classList="teamGuessDeleteButton";t.appendChild(i);r.appendChild(t)}function updatePlayerPanelButtons(n){if(n){var t=[],i=localStorage.getItem("teamNumber");i==="1"?n.teamOneInnerPanels<=0&&(t=t.concat(innerPanels)):n.teamTwoInnerPanels<=0&&(t=t.concat(innerPanels));updatePanelButtons(currentGameState,t)}}async function handleRandomizeTeam(n){clearPanelButtonSelection();parseInt(localStorage.getItem("teamNumber"))!==n.teamNumber?(drawTeam(n.teamNumber),await drawChatsAsync("chats"),drawSystemChat("chats","The teams have been randomized; you are now on the other team.")):drawSystemChat("chats","The teams have been randomized; you have not changed teams.")}function registerConnections(){connection.on("Chat",(n,t)=>{drawChat("chats",t,n)});connection.on("Typing",n=>{handleTyping("chats",n)});connection.on("AddPlayer",n=>{n.playerId!==localStorage.getItem("playerId")&&drawSystemChat("chats","has joined the team.",n)});connection.on("GameState",handleGameState);connection.on("AddTeamGuess",drawTeamGuess);connection.on("DeleteTeamGuess",deleteTeamGuess);connection.on("RandomizeTeam",handleRandomizeTeam);connection.onreconnected=function(){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR reconnected")};connection.onclose(async function(){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR closed.");await startSignalRAsync("player")})}var across=5,down=4,currentGameState,connection,reconnectingCount=0,signalRTimeOut=!1,lastTypingTime,playersTyping,typingIndicatorsTimeouts,playerLoaded,playerIsReadyToPlay,connectionCount;localStorage.getItem("playerId")||localStorage.setItem("playerId",uuidv4());const urlParams=new URLSearchParams(window.location.search),debugParam=urlParams.get("debug");debugParam==="true"?localStorage.setItem("debug",!0):debugParam==="false"&&localStorage.removeItem("debug");window.location.href.indexOf("azurewebsites")>=0&&(window.location.href="https://picturepanels.net");const typingIndicatorTime=6e3,imageRegex=/(http([^\s]*))/gi;playersTyping={};typingIndicatorsTimeouts={};playerLoaded=!1;playerIsReadyToPlay=!1;const innerPanels=["7","8","9","12","13","14"],outerPanels=["1","2","3","4","5","6","10","11","15","16","17","18","19","20"];window.onresize=function(){var n=document.getElementById("chats");n.classList.remove("smoothScroll");scrollChats("chats",!0);n.classList.add("smoothScroll")};connectionCount=0;window.onload=async function(){handleGameState(await getGameStateAsync());var n=document.getElementById("teamGuessesButton");n.onclick=()=>{postTeamGuessAsync()};drawPanelButtons();setupPlayerMenu();setupPlayerAsync();document.getElementById("chooseSmallestTeam").innerHTML="Choose for me";setInterval(putPlayerPingAsync,3e4)};