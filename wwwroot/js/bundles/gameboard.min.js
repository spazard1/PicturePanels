async function isAuthorized(){return await fetch("/api/authorize",{method:"GET",headers:{Authorization:localStorage.getItem("Authorization")}}).then(n=>n.ok)}async function getGameStateAsync(){return await fetch("/api/gameState").then(n=>n.json()).then(n=>n)}async function getPlayer(){return await fetch("api/players/"+localStorage.getItem("playerId")).then(n=>n.json()).then(n=>n)}async function getPlayersAsync(){return await fetch("/api/players").then(n=>n.json()).then(n=>n)}async function getImageEntityAsync(n){return fetch("/api/images/entity/"+n).then(n=>n.json()).then(n=>n).catch(()=>null)}function mobileCheck(){let n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}async function loadImageAsync(n,t){return new Promise((i,r)=>{n.onload=()=>i(n),n.onerror=r,n.src=t})}function loadThemeCss(n){n.themeCss&&(document.getElementById("themeCssLink").href.indexOf(n.themeCss)>0||(document.getElementById("themeCssLink").href="themes/"+n.themeCss+".css"))}async function getBlobContainers(){return await fetch("/api/images/blobContainers",{method:"GET",headers:{Authorization:localStorage.getItem("Authorization")}}).then(n=>n.json()).then(n=>n)}function drawBlobContainers(n,t){var i=document.getElementById(t);n.forEach(function(n){var t=document.createElement("option");t.value=n.name;t.appendChild(document.createTextNode(n.name));i.appendChild(t)})}function drawGameState(n){Object.keys(n).forEach(function(t){var i=document.getElementById(t);i&&(i.nodeName==="DIV"||i.nodeName==="SPAN"?document.getElementById(t).innerHTML=n[t]:document.getElementById(t).value=n[t])})}function drawPanelButtons(){for(var u,n,t,i,f,r=1,o=document.getElementById("panelButtons"),e=0;e<down;e++)for(u=0;u<across;u++)n=document.createElement("div"),n.classList.add("panelButton"),n.classList.add("noHighlights"),n.classList.add("panelButtonDisabled"),n.onclick=panelButtonOnClick,n.value=r+"",t=document.createElement("div"),t.classList.add("panelButtonBackground"),n.appendChild(t),i=document.createElement("div"),i.classList.add("panelButtonNumber"),i.appendChild(document.createTextNode(r)),t.appendChild(i),f=document.createElement("img"),f.classList.add("panelButtonImage"),n.appendChild(f),o.appendChild(n),r++}function updatePanelButtons(n,t){var u=document.getElementsByClassName("panelButton"),i,r;t||(t=[]);for(i of u)r=i.lastChild,n.revealedPanels.includes(i.value)?(i.classList.add("panelButtonDisabled"),i.classList.remove("panelButtonSelected"),r.src="/api/images/panels/"+n.imageId+"/"+i.value):t.includes(i.value)?(i.classList.add("panelButtonDisabled"),i.classList.remove("panelButtonSelected"),r.src="/api/images/panels/"+n.imageId+"/0"):(i.classList.remove("panelButtonDisabled"),r.src="/api/images/panels/"+n.imageId+"/0")}function shuffle(n){for(var t=n.length,r,i;0!==t;)i=Math.floor(Math.random()*t),t-=1,r=n[t],n[t]=n[i],n[i]=r;return n}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}function clearPanelButtonSelection(){var n=document.getElementsByClassName("panelButton");for(var t of n)t.classList.remove("panelButtonSelected")}async function sendSelectedPanels(){var n,i,t;if(localStorage.getItem("playerName")){n=[];i=document.getElementsByClassName("panelButtonSelected");for(t of i)t.classList.contains("panelButtonDisabled")||n.push(t.value);await connection.invoke("SelectPanels",{PlayerId:localStorage.getItem("playerId"),Name:localStorage.getItem("playerName"),TeamNumber:parseInt(localStorage.getItem("teamNumber")),SelectedPanels:n})}}function pixelRatio(){let n=window.screen.width,t=window.screen.height,i=window.devicePixelRatio;document.getElementById("width").innerHTML=n;document.getElementById("height").innerHTML=t;document.getElementById("ratio").innerHTML=i;console.log("Width: "+n);console.log("Height: "+t);console.log("Pixel  Ratio: "+i)}function getRenderedSize(n,t,i,r,u,f){var e=r/u,o=t/i;return function(){return(n?e>o:e<o)?(this.width=t,this.height=t/e):(this.width=i*e,this.height=i),this.left=(t-this.width)*(f/100),this.right=this.width+this.left,this}.call({})}function getImgSizeInfo(n){var t=window.getComputedStyle(n).getPropertyValue("object-position").split(" ");return getRenderedSize(!0,n.width,n.height,n.naturalWidth,n.naturalHeight,parseInt(t[0]))}function setupInputDefaultText(n,t,i){var r=document.getElementById(n);r.defaultValue=t;i?r.value=i:(r.classList.add("inputDefaultText"),r.value=r.defaultValue);r.onfocus=n=>{n.target.value===n.target.defaultValue&&(n.target.value="",n.target.classList.remove("inputDefaultText"))};r.onblur=n=>{n.target.value||(n.target.value=n.target.defaultValue,n.target.classList.add("inputDefaultText"))};r.onchange=n=>{n&&n.target.value&&n.target.value!==n.target.defaultValue||(n.target.value=n.target.defaultValue,n.target.classList.add("inputDefaultText"))}}function setupAdminMenu(){var n=document.getElementById("adminMenu"),u=document.createElement("a"),t,i,r;u.appendChild(document.createTextNode("Admin"));u.href="admin";n.appendChild(u);t=document.createElement("a");t.appendChild(document.createTextNode("Upload"));t.href="upload";n.appendChild(t);i=document.createElement("a");i.appendChild(document.createTextNode("List"));i.href="listimages";n.appendChild(i);r=document.createElement("a");r.appendChild(document.createTextNode("Setup"));r.href="setup";n.appendChild(r)}function createSignalRConnection(n){connection=(new signalR.HubConnectionBuilder).withUrl("/signalRHub?user="+localStorage.getItem("playerId")+"_"+n).withAutomaticReconnect().configureLogging(signalR.LogLevel.Information).build();registerConnections()}function signalRMonitor(){if(!connection){reconnectingCount=0;document.getElementById("signalRConnectionState").classList.add("hidden");return}if(connection.state==="Connected"){document.getElementById("signalRConnectionState").classList.add("hidden");return}if(document.getElementById("signalRConnectionState").classList.remove("hidden"),connection.state==="Disconnecting"||connection.state==="Disconnected"){document.getElementById("signalRConnectionState").innerHTML="Disconnected from server. <a href='javascript: window.location.reload(true);'>Reload Page<\/a>";return}if(connection.state==="Connecting"||connection.state==="Reconnecting"){reconnectingCount++;document.getElementById("signalRConnectionState").innerHTML=reconnectingCount>4?"Reconnecting to server...<a href='javascript: window.location.reload(true);'>Reload Page<\/a>":"Reconnecting to server...";return}}function reloadPage(){location.reload()}function animateCSS(n,t,i,r=0,u=false,f="animate__"){function o(n){n.stopPropagation();e.classList.remove(...t)}var e;return e=typeof n!="string"?n:document.querySelector(n),e.classList.add(f+"animated"),new Promise(n=>{setTimeout(()=>{t=t.map(n=>f+n),i=i.map(n=>f+n),e.classList.add(...t),e.classList.remove(...i),u&&e.addEventListener("animationend",o,{once:!0}),n()},r)})}async function startSignalRAsync(n){if(!document.getElementById("signalRConnectionState")){var t=document.createElement("div");t.classList="hidden";t.id="signalRConnectionState";document.body.appendChild(t)}if(connection&&connection.state==="Connected"){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR already connected.");return}signalRTimeOut||(createSignalRConnection(n),await connection.start(),setTimeout(function(){signalRTimeOut=!0;playerIsReadyToPlay=!1;drawSystemChat("chats","You have been disconnected from the server. Refresh the page to connect again.");connection.stop()},144e5),setInterval(signalRMonitor,1e3),localStorage.getItem("debug")&&drawSystemChat("chats","SignalR started: "+n))}function createPanels(){for(var u,n,i,r,f,t=1,o=document.getElementById("panels"),e=0;e<down;e++)for(u=0;u<across;u++)n=document.createElement("div"),n.classList.add("panel"),n.id="panel_"+t,n.panelNumber=""+t,n.value=t+"",i=document.createElement("div"),i.classList.add("panelBackground"),i.classList.add("animate__animated"),i.classList.add("animate__slow"),n.appendChild(i),r=document.createElement("div"),r.id="panelNumber_"+t,r.classList.add("panelNumber"),r.appendChild(document.createTextNode(t)),i.appendChild(r),f=document.createElement("img"),f.classList.add("panelImage"),n.appendChild(f),o.appendChild(n),t++}function createMostVotesPanels(){for(var n,t,r=document.getElementById("mostVotesPanels"),i=0;i<maxMostVotesPanels;i++)n=document.createElement("div"),n.classList.add("mostVotesPanel"),n.classList.add("opacity0"),t=document.createElement("img"),t.classList.add("panelImage"),n.appendChild(t),r.appendChild(n)}function openPanel(n){n.classList.contains("panelOpen")||(n.classList.add("panelOpen"),animateCSS(n.firstChild,[exitAnimations[Math.floor(Math.random()*exitAnimations.length)]],entranceAnimations))}function resetPanel(n,t,i){if(!n.classList.contains("panelOpen")){animateCSS(n.firstChild,[],exitAnimations,0,!0);return}n.classList.remove("panelOpen");animateCSS(n.firstChild,[t],exitAnimations,i,!0)}async function resetPanelsAsync(n){var i=[],e=document.getElementsByClassName("panel"),o=entranceAnimations[Math.floor(Math.random()*entranceAnimations.length)],r=0,t,u,f;for(t of e)resetPanel(t,o,r),r+=50,i.push(loadImageAsync(t.lastChild,"/api/images/panels/"+n.imageId+"/0"));u=document.getElementsByClassName("mostVotesPanel");for(f of u)f.classList.add("opacity0");await Promise.all(i);resizePanelContainer()}function resizePanelContainer(){var n=document.getElementById("panels");n.style.maxWidth="";for(var t=n.getBoundingClientRect(),i=83;t.height+t.y>=window.innerHeight-5;){if(i-=.5,i<10)break;n.style.maxWidth=i+"vw";t=n.getBoundingClientRect()}}function updatePlayer(n){var t=document.getElementById("player_"+n.playerId),i;t||(t=document.createElement("div"),t.classList="teamPlayerName",t.id="player_"+n.playerId,t.playerId=n.playerId);t.innerHTML=n.name;t.style.borderColor=n.color;i=null;playerSelectedPanels[n.playerId]=n;i=n.teamNumber===1?document.getElementById("teamOnePlayerNames"):document.getElementById("teamTwoPlayerNames");i!==t.parentNode&&i.appendChild(t);setPlayerFuzzies(n);updatePlayerDots(n)}function setPlayerFuzzies(n){playerFuzzies[n.playerId]||(playerFuzzies[n.playerId]={},Math.random()<.5?(playerFuzzies[n.playerId].fuzzX=Math.random(),playerFuzzies[n.playerId].fuzzX<.5+middleXOffset&&playerFuzzies[n.playerId].fuzzX>.5-middleXOffset?(playerFuzzies[n.playerId].fuzzY=.5*Math.random()*(1-middleYOffset*2),Math.random()<.5&&(playerFuzzies[n.playerId].fuzzY=.5+middleYOffset+playerFuzzies[n.playerId].fuzzY)):playerFuzzies[n.playerId].fuzzY=Math.random()):(playerFuzzies[n.playerId].fuzzY=Math.random(),playerFuzzies[n.playerId].fuzzY<.5+middleYOffset&&playerFuzzies[n.playerId].fuzzY>.5-middleYOffset?(playerFuzzies[n.playerId].fuzzX=.5*Math.random()*(1-middleXOffset*2),Math.random()<.5&&(playerFuzzies[n.playerId].fuzzX=.5+middleXOffset+playerFuzzies[n.playerId].fuzzX)):playerFuzzies[n.playerId].fuzzX=Math.random()))}function drawMostVotesPanels(n){var i,r,f,u,o,t,s,e;if(n&&resetMaxVotesPanels(),i=document.getElementsByClassName("mostVotesPanel"),currentGameState.turnType!=="OpenPanel"&&currentGameState.turnType!=="OpenFreePanel"){for(o of i)o.classList.add("opacity0");return}for(r={},t=1;t<=across*down;t++)r[t+""]=0;for(const n in playerSelectedPanels)playerSelectedPanels[n].teamNumber===currentGameState.teamTurn&&playerSelectedPanels[n].selectedPanels.forEach(n=>{r[n]++});f=0;u=[];for(const n in r)(s=document.getElementById("panel_"+n),s.classList.contains("panelOpen"))||(r[n]>f?(f=r[n],u=[n]):r[n]===f&&u.push(n));if(f===0||u.length>maxMostVotesPanels)for(o of i)o.classList.add("opacity0");else for(t=0;t<maxMostVotesPanels;t++)u.length>t?(s=document.getElementById("panel_"+u[t]),e=s.getBoundingClientRect(),i[t].classList.remove("opacity0"),i[t].style.transform="translate("+e.x+"px,"+e.y+"px)",i[t].style.width=e.width+"px",i[t].style.height=e.height+"px"):i[t].classList.add("opacity0")}function drawTeamStatus(n,t){var i=document.getElementById("teamStatus"),r=document.getElementById("teamOneCountdownCanvas"),u=document.getElementById("teamTwoCountdownCanvas");if(n.teamTurn===1?(activeTeamCountdownCanvas=document.getElementById("teamOneCountdownCanvas"),passiveTeamCountdownCanvas=document.getElementById("teamTwoCountdownCanvas")):(passiveTeamCountdownCanvas=document.getElementById("teamOneCountdownCanvas"),activeTeamCountdownCanvas=document.getElementById("teamTwoCountdownCanvas")),n.teamTurn===1?(document.getElementById("teamOneDiv").classList.add("activeTeam"),document.getElementById("teamTwoDiv").classList.remove("activeTeam")):(document.getElementById("teamOneDiv").classList.remove("activeTeam"),document.getElementById("teamTwoDiv").classList.add("activeTeam")),n.turnType==="Welcome"){i.innerHTML="";stopCountdown(activeTeamCountdownCanvas);stopCountdown(passiveTeamCountdownCanvas);return}(n.turnType==="GuessesMade"||n.turnType==="EndRound")&&(stopCountdown(activeTeamCountdownCanvas),stopCountdown(passiveTeamCountdownCanvas));t&&(stopCountdown(activeTeamCountdownCanvas),stopCountdown(passiveTeamCountdownCanvas));switch(n.turnType){case"OpenPanel":i.innerHTML=n.teamTurn===1?"&larr; Open a Panel":"Open a Panel &rarr;";t&&(n.revealedPanels.length===0?startCountdown(activeTeamCountdownCanvas,n.openPanelTime,8):startCountdown(activeTeamCountdownCanvas,n.openPanelTime,3));break;case"MakeGuess":i.innerHTML="Guess or Pass";t&&(startCountdown(activeTeamCountdownCanvas,n.guessTime,3),startCountdown(passiveTeamCountdownCanvas,n.guessTime,3));n.teamOneGuessStatus&&stopCountdown(r);n.teamTwoGuessStatus&&stopCountdown(u);break;case"GuessesMade":i.innerHTML="Who was right?";break;case"EndRound":i.innerHTML="Round "+n.roundNumber+" Complete";break;default:i.innerHTML=n.turnType}}function drawTeamGuesses(n){var t=document.getElementById("teamOneGuessText"),i=document.getElementById("teamTwoGuessText"),r,u;if(t.classList.remove("teamGuessIncorrect"),i.classList.remove("teamGuessIncorrect"),n.turnType!=="GuessesMade"){animateCSS(t,["bounceOutUp"],["slow","bounceInDown","tada","repeat-3"]);animateCSS(i,["bounceOutUp"],["slow","bounceInDown","tada","repeat-3"]);return}r='"'+n.teamOneGuess+'"';n.teamOneGuessStatus!=="Guess"&&(r="(team passed)");u='"'+n.teamTwoGuess+'"';n.teamTwoGuessStatus!=="Guess"&&(u="(team passed)");n.teamTurn===1?(drawTeamGuess(r,t,1e3),drawTeamGuess(u,i,3e3)):(drawTeamGuess(u,i,1e3),drawTeamGuess(r,t,3e3))}function drawTeamGuess(n,t,i){n.length>20?t.classList.add("teamGuessLong"):t.classList.remove("teamGuessLong");animationPromise=animationPromise.then(()=>animateCSS(t,["slow","bounceInDown"],["bounceOutUp"],i)).then(()=>(t.innerHTML=n.split("").map((n,i)=>"<span class='letter' style='animation-delay:"+(2+i/Math.max(10,t.textContent.length))+"s'>"+n+"<\/span>").join(""),new Promise(n=>{setTimeout(n,3e3)})))}function drawTeamGuessHighlights(n){if(n.turnType==="GuessesMade"){var t=document.getElementById("teamOneGuessText"),i=document.getElementById("teamTwoGuessText");n.teamOneCorrect?animationPromise=animationPromise.then(()=>animateCSS(t,["tada","repeat-3"],["slow","bounceInDown"])):n.teamOneGuessStatus!=="Guess"||n.teamOneCorrect||(animationPromise=animationPromise.then(()=>(t.innerHTML='"'+n.teamOneGuess+'"',t.classList.add("teamGuessIncorrect"),Promise.resolve())));animationPromise=n.teamTwoCorrect?animationPromise.then(()=>animateCSS(i,["tada","repeat-3"],["slow","bounceInDown"])):animationPromise.then(()=>(i.innerHTML='"'+n.teamTwoGuess+'"',i.classList.add("teamGuessIncorrect"),Promise.resolve()))}}function drawTeamScoreChange(n){var t=document.getElementById("teamOneScoreText"),i=document.getElementById("teamTwoScoreText"),r=document.getElementById("teamOneScoreChange"),u=document.getElementById("teamTwoScoreChange");n.turnType==="GuessesMade"?(n.teamOneGuessStatus==="Guess"&&n.teamTwoGuessStatus==="Guess"?(animationPromise=animationPromise.then(()=>animateCSS(r,["slow","bounceInDown"],["bounceOutUp"],3e3)),animationPromise=animationPromise.then(()=>animateCSS(u,["slow","bounceInDown"],["bounceOutUp"])),delay=0):n.teamOneGuessStatus==="Guess"?animationPromise=animationPromise.then(()=>animateCSS(r,["slow","bounceInDown"],["bounceOutUp"],3e3)):n.teamTwoGuessStatus==="Guess"&&(animationPromise=animationPromise.then(()=>animateCSS(u,["slow","bounceInDown"],["bounceOutUp"],3e3))),animationPromise=animationPromise.then(()=>(drawTeamScoreChangeText(n),Promise.resolve())),(n.teamOneCorrect||n.teamTwoCorrect)&&(animationPromise=animationPromise.then(()=>new Promise(r=>{setTimeout(()=>{t.innerHTML=n.teamOneScore,i.innerHTML=n.teamTwoScore,r()},2e3)})))):(t.innerHTML=n.teamOneScore,i.innerHTML=n.teamTwoScore,animateCSS(r,["bounceOutUp"],["slow","bounceInDown"]),animateCSS(u,["bounceOutUp"],["slow","bounceInDown"]));t.innerHTML||(t.innerHTML=n.teamOneScore,i.innerHTML=n.teamTwoScore)}function drawTeamScoreChangeText(n){var t=document.getElementById("teamOneScoreChange"),i=document.getElementById("teamTwoScoreChange");n.teamOneCorrect&&n.teamTwoCorrect?n.teamTurn===1?(t.innerHTML="+5",i.innerHTML="+2"):(t.innerHTML="+2",i.innerHTML="+5"):n.teamOneCorrect?(t.innerHTML="+5",i.innerHTML=""):n.teamTwoCorrect?(t.innerHTML="",i.innerHTML="+5"):(t.innerHTML="",i.innerHTML="")}function isOverflown(n){return n.scrollHeight>n.clientHeight||n.scrollWidth>n.clientWidth}function setupCanvases(){var u=document.getElementsByClassName("countdownCanvas"),n,i,t,r;for(n of u)n.style="",i=n.getContext("2d"),i.scale(window.devicePixelRatio,window.devicePixelRatio),t=Math.floor(n.clientHeight),n.style.height=t+"px",n.style.width=t+"px",n.height=t*window.devicePixelRatio,n.width=t*window.devicePixelRatio,r=Math.floor(t/2)*window.devicePixelRatio,i.translate(r,r),i.rotate(1.5*Math.PI),i.translate(-r,-r)}function startCountdown(n,t,i=0){t<=0||(n.currentCountdown=t+i,n.countdownMax=t,clearInterval(n.countdownInterval),n.countdownInterval=setInterval(function(){n.currentCountdown-=1/framerate;drawCountdown(n);n.currentCountdown<=0&&clearInterval(n.countdownInterval)},1e3/framerate))}function stopCountdown(n){n.currentCountdown=0}function drawCountdown(n){var t=n.getContext("2d"),i=.55;if(t.clearRect(0,0,n.width,n.height),!(n.currentCountdown<=0)){var u=n.height/2*i,r=n.height/2,f=n.height/2*i;t.beginPath();t.arc(r,r,u,0,Math.min(n.currentCountdown,n.countdownMax)/n.countdownMax*2*Math.PI);t.strokeStyle="white";t.lineWidth=f;t.stroke()}}function setClassStyle(n,t){for(var u,r,i=0;i<document.styleSheets.length;i++)if(document.styleSheets[i].href.endsWith("gameboard.css"))for(u=document.styleSheets[i].cssRules,r=0;r<u.length;r++)u[r].selectorText===n&&t(u[r])}function hideMostVotesPanels(){setClassStyle(".mostVotesPanel",n=>{n.style.opacity=0})}function hidePlayerDots(n){var t,i;if(n){t=document.getElementsByClassName("playerDot_panelNumber_"+n);for(i of t)i.classList.add("opacity0")}else setClassStyle(".playerDot",n=>{n.style.opacity=0})}function drawPlayerDots(n){for(var i,r=document.getElementsByClassName("panel"),t=1;t<=across*down;t++)i=document.getElementById("playerDot_"+n.playerId+"_"+t),i&&drawPlayerDot(r,i,currentGameState)}function drawAllPlayerDots(n,t){var i,r,u;t&&resetPlayerDots();i=document.getElementsByClassName("playerDot");r=document.getElementsByClassName("panel");for(u of i)drawPlayerDot(r,u,n)}function drawPlayerDot(n,t,i){playerSelectedPanels[t.player.playerId]&&playerSelectedPanels[t.player.playerId].selectedPanels.includes(t.panelNumber+"")&&t.player.teamNumber===currentGameState.teamTurn&&!n[t.panelNumber-1].classList.contains("panelOpen")&&(i.turnType==="OpenPanel"||i.turnType==="OpenFreePanel")?movePlayerDotToPanel(t):movePlayerDotToPlayer(t)}function updatePlayerDots(n){for(var i,r,t=1;t<=across*down;t++)i=document.getElementById("playerDot_"+n.playerId+"_"+t),i||(i=createPlayerDot(n,t)),i.style.fill=n.color,i.player=n,n.name&&(r=n.name.trim().indexOf(" "),document.getElementById("playerDotInitials_"+n.playerId+"_"+t).innerHTML=r>0?n.name.charAt(0)+n.name.charAt(r+1):n.name.substring(0,2))}function createPlayerDot(n,t){var s=document.getElementById("player_"+n.playerId),f,e,r,o;playerElementRect=s.getBoundingClientRect();var u=Math.ceil(playerElementRect.height*1.1),i=document.createElement("div");return i.id="playerDot_"+n.playerId+"_"+t,i.player=n,i.panelNumber=t,i.style.width=u+"px",i.style.height=u+"px",i.classList.add("playerDot_panelNumber_"+t),i.classList.add("playerDot"),i.classList.add("opacity0"),i.classList.add("playerDot_"+n.playerId),document.body.appendChild(i),f=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElement("div"),e.id="playerDotInitials_"+n.playerId+"_"+t,r=document.createElementNS("http://www.w3.org/2000/svg","circle"),r.setAttribute("r",Math.max(1,u/2-2)),r.setAttribute("cx",u/2),r.setAttribute("cy",u/2),r.setAttribute("stroke","black"),r.setAttribute("stroke-width",2),f.appendChild(r),i.appendChild(f),i.appendChild(e),o=Math.ceil(Math.random()*500)+100,i.style.zIndex=o,i}function random(n,t){return Math.floor(Math.random()*(t-n)+n)}function resetPlayerDots(){var t=document.getElementsByClassName("playerDot");for(var n of t)n.player.selectedPanels=[],n.classList.add("opacity0"),movePlayerDotToPlayer(n);setClassStyle(".playerDot",n=>{n.style.removeProperty("opacity")})}function movePlayerDotToPlayer(n){var i=document.getElementById("player_"+n.player.playerId),t;if(!i){n.remove();return}t=i.getBoundingClientRect();n.style.transform="translate("+t.x+"px,"+t.y+"px)";n.style.zIndex=Math.ceil(Math.random()*500)+100;n.classList.add("opacity0")}function movePlayerDotToPanel(n){var n=document.getElementById("playerDot_"+n.player.playerId+"_"+n.panelNumber),t=document.getElementById("panel_"+n.panelNumber).getBoundingClientRect(),i=n.getBoundingClientRect(),r=(t.right-t.left-i.width)*Math.abs(playerFuzzies[n.player.playerId].fuzzX)+t.left,u=(t.bottom-t.top-i.height)*Math.abs(playerFuzzies[n.player.playerId].fuzzY)+t.top;n.style.transform="translate("+r+"px,"+u+"px)";n.classList.remove("opacity0")}function resetMaxVotesPanels(){playerSelectedPanels={};setClassStyle(".mostVotesPanel",n=>{n.style.removeProperty("opacity")})}async function openAllPanelsAsync(){var r,n,u,t,i,f;hidePlayerDots();hideMostVotesPanels();r=document.getElementsByClassName("panel");n=[];for(u of r)n.push(u);shuffle(n);t=0;i=[];n.forEach(function(n){n.classList.contains("panelOpen")||i.push(loadImageAsync(n.lastChild,"/api/images/panels/"+currentGameState.imageId+"/"+n.panelNumber))});await Promise.all(i);f=[];n.forEach(function(n){new Promise(i=>{n.classList.contains("panelOpen")||(setTimeout(function(){openPanel(n);i()},t),t+=150)})});await Promise.all(f)}function drawRoundNumber(n){if(n.revealedPanels.length===0&&n.turnType==="OpenPanel"){document.getElementById("roundNumberAnimateText").innerHTML="Round "+n.roundNumber;var i=document.getElementById("roundNumberAnimate"),t=Promise.resolve();t=t.then(()=>animateCSS(i,["backInLeft"],["backOutRight"],3e3));t=t.then(()=>animateCSS(i,["backOutRight"],["backInLeft"],4e3))}}async function drawImageEntityAsync(n){var t=await getImageEntityAsync(n.imageId),i=document.getElementById("uploadedBy");t&&t.uploadedBy!=="admin"?(i.innerHTML="Uploaded by: "+t.uploadedBy,animateCSS(i,["slow","bounceInRight"],["bounceOutRight"],3e3)):animateCSS(i,["bounceOutRight"],["slow","bounceInRight"]);t&&t.name?animationPromise=animationPromise.then(()=>animateCSS("#answerTitle",["slow","bounceInDown"],["bounceOutUp"],2e3)).then(()=>{var i=document.getElementById("answerTitle"),n;i.innerHTML="";n=document.createElement("div");n.appendChild(document.createTextNode(t.name));n.classList.add("answerTitleText");i.appendChild(n)}):animateCSS("#answerTitle",["bounceOutUp"],["slow","bounceInDown"])}async function drawRevealedPanelsAsync(n){var i,u,t,r;if(n.turnType==="EndRound")return openAllPanelsAsync();n.turnType==="GuessesMade"&&(animationPromise=n.teamOneCorrect||n.teamTwoCorrect?animationPromise.then(()=>new Promise(n=>{setTimeout(()=>{openAllPanelsAsync().then(()=>n())},5e3)})):animationPromise.then(()=>new Promise(n=>{setTimeout(n,5e3)})));i=[];u=document.getElementsByClassName("panel");for(t of u)r=t.lastChild,n.revealedPanels.includes(t.panelNumber)?(t.classList.contains("panelOpen")||i.push(loadImageAsync(r,"/api/images/panels/"+n.imageId+"/"+t.panelNumber).then(n=>{openPanel(n.parentElement)})),hidePlayerDots(t.panelNumber)):(t.classList.remove("panelOpen"),r.src="/api/images/panels/"+n.imageId+"/0");await Promise.all(i)}function drawIncorrectGuesses(n){var t=()=>(document.getElementById("teamOneIncorrectGuessesDiv").innerHTML=n.teamOneIncorrectGuesses<=3?"&olcross;".repeat(n.teamOneIncorrectGuesses):n.teamOneIncorrectGuesses+" &olcross;",document.getElementById("teamTwoIncorrectGuessesDiv").innerHTML=n.teamTwoIncorrectGuesses<=3?"&olcross;".repeat(n.teamTwoIncorrectGuesses):n.teamTwoIncorrectGuesses+" &olcross;",Promise.resolve());document.getElementById("teamOneIncorrectGuessesDiv").innerHTML||document.getElementById("teamTwoIncorrectGuessesDiv").innerHTML?animationPromise=animationPromise.then(t):t()}function drawPanelCounts(n){var u=document.getElementById("teamOneInnerPanelsCount"),f=document.getElementById("teamTwoInnerPanelsCount"),t,i,r;if(n.teamOneInnerPanels>u.children.length||n.teamTwoInnerPanels>f.children.length){for(u.innerHTML="",f.innerHTML="",t=0;t<n.teamOneInnerPanels;t++)i=document.createElement("div"),i.className="animate__animated animate__slow teamOneBox",u.appendChild(i),i.addEventListener("animationend",()=>{u.lastChild.remove()});for(t=0;t<n.teamTwoInnerPanels;t++)i=document.createElement("div"),i.className="animate__animated animate__slow teamTwoBox",f.appendChild(i),i.addEventListener("animationend",()=>{f.lastChild.remove()})}else{for(r=u.children,t=0;t<r.length;t++)n.teamOneInnerPanels<=t&&r[t].classList.add("animate__rollOut");for(r=f.children,t=0;t<r.length;t++)n.teamTwoInnerPanels<=t&&r[t].classList.add("animate__rollOut")}}function setupWelcomeAnimationAsync(){var t=[],i=document.getElementsByClassName("panel");for(var n of i)n.classList.remove("panelOpen"),t.push(loadImageAsync(n.lastChild,"/api/images/panels/welcome/"+n.panelNumber));return Promise.all(t)}function drawWelcomeAnimation(){var r,t,i,n;hidePlayerDots();hideMostVotesPanels();r=document.getElementsByClassName("panel");t=[];for(n of r)t.push(n);do i=Math.floor(Math.random()*t.length);while(i===previousRandomIndex);previousRandomIndex=i;n=t[i];n.classList.contains("panelOpen")?n.classList.remove("panelOpen"):n.classList.add("panelOpen")}function stopWelcomeAnimation(){document.getElementById("welcome").classList.add("hidden");clearInterval(welcomeAnimationTimeout);welcomeAnimationTimeout=null}async function handleGameState(n,t){if(loadThemeCss(n),animationPromise=Promise.resolve(),n.turnType==="Welcome"){await setupWelcomeAnimationAsync();welcomeAnimationTimeout||(welcomeAnimationTimeout=setInterval(drawWelcomeAnimation,1500));document.getElementById("welcome").classList.remove("hidden");n.imageId="welcome";drawGameState(n);resizePanelContainer();return}(t||n.imageId!==currentGameState.imageId)&&await resetPanelsAsync(n);stopWelcomeAnimation();var i=n.turnType!==currentGameState.turnType||n.teamTurn!==currentGameState.teamTurn||n.imageId!==currentGameState.imageId;currentGameState=n;drawGameState(n);drawRoundNumber(n);drawTeamStatus(n,t||i);drawTeamGuesses(n);await drawRevealedPanelsAsync(n);await drawImageEntityAsync(n);drawTeamGuessHighlights(n);drawTeamScoreChange(n);drawIncorrectGuesses(n);drawPanelCounts(n);drawAllPlayerDots(n,i);drawMostVotesPanels(i)}function handlePlayers(n){var r,t,i;allPlayers=n;r=document.getElementsByClassName("teamPlayerName");for(t of r)i=!1,n.forEach(n=>{"player_"+n.playerId===t.id&&(i=!0)}),i||t.remove();n.forEach(n=>{updatePlayer(n)})}function handleAddPlayer(n){playerSelectedPanels[n.playerId]=n;updatePlayer(n);drawPlayerDots(n);drawMostVotesPanels()}function handleSelectPanels(n){playerSelectedPanels[n.playerId]=n;drawPlayerDots(n);drawMostVotesPanels()}function drawSystemChat(n,t){document.getElementById("teamOneStatus").innerHTML=t}function registerConnections(){connection.on("Players",handlePlayers);connection.on("AddPlayer",handleAddPlayer);connection.on("SelectPanels",handleSelectPanels);connection.on("GameState",handleGameState);connection.onreconnected=function(){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR reconnected")};connection.onclose(async function(){localStorage.getItem("debug")&&drawSystemChat("chats","SignalR closed.");await startSignalRAsync("gameboard")})}function disappearCursor(){mouseTimer=null;document.body.style.cursor="none";cursorVisible=!1}var across=5,down=4,currentGameState,connection,reconnectingCount=0,signalRTimeOut=!1,playerSelectedPanels,framerate,allPlayers,welcomeAnimationTimeout,previousRandomIndex,animationPromise,mouseTimer,cursorVisible,reloadTimeout;localStorage.getItem("playerId")||localStorage.setItem("playerId",uuidv4());const urlParams=new URLSearchParams(window.location.search),debugParam=urlParams.get("debug");debugParam==="true"?localStorage.setItem("debug",!0):debugParam==="false"&&localStorage.removeItem("debug");window.location.href.indexOf("azurewebsites")>=0&&(window.location.href="https://picturepanels.net");var entranceAnimations=["backInDown","backInLeft","backInRight","backInUp","bounceInDown","bounceInLeft","bounceInRight","bounceInUp","fadeInDown","fadeInLeft","fadeInRight","fadeInUp","fadeInTopLeft","fadeInTopRight","fadeInBottomLeft","fadeInBottomRight","flipInX","flipInY","jackInTheBox","rollIn","zoomIn","zoomInDown","zoomInLeft","zoomInRight","zoomInUp","slideInDown","slideInLeft","slideInRight","slideInUp"],exitAnimations=["backOutDown","backOutLeft","backOutRight","bounceOutDown","bounceOutLeft","bounceOutRight","bounceOutUp","fadeOutDown","fadeOutLeft","fadeOutRight","fadeOutUp","fadeOutTopLeft","fadeOutTopRight","fadeOutBottomLeft","fadeOutBottomRight","flipOutX","flipOutY","lightSpeedOutRight","lightSpeedOutLeft","hinge","rollOut","zoomOut","zoomOutDown","zoomOutLeft","zoomOutRight","zoomOutUp"],maxMostVotesPanels=3;playerSelectedPanels={};var middleXOffset=.2,middleYOffset=.25,playerFuzzies={};framerate=20;allPlayers=[];previousRandomIndex=-1;mouseTimer=null;cursorVisible=!0;window.onresize=function(){clearTimeout(reloadTimeout);reloadTimeout=setTimeout(function(){resizePanelContainer();setupCanvases()},100)};window.onload=async function(){createPanels();createMostVotesPanels();setupCanvases();document.onmousemove=function(){clearTimeout(mouseTimer);cursorVisible||(document.body.style.cursor="default",cursorVisible=!0);mouseTimer=window.setTimeout(disappearCursor,3e3)};startSignalRAsync("gameboard").then(function(){connection.invoke("RegisterGameBoard")});var n=[];n.push(getGameStateAsync());n.push(getPlayersAsync());Promise.all(n).then(n=>{currentGameState=n[0],handleGameState(currentGameState,!0),handlePlayers(n[1])})};